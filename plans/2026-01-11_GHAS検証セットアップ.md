# GHAS検証用ダミーコードセットアップ計画

## 概要
GitHub Advanced Security (GHAS) の3つの主要機能を検証するため、意図的に脆弱性を含むPythonコードと設定を追加します。

## 検証対象のGHAS機能
1. **Code Scanning (CodeQL)**: コード内のセキュリティ脆弱性を検出
2. **Secret Scanning**: APIキーやトークンなどのシークレット情報を検出
3. **Dependency Review**: 依存関係の既知の脆弱性を検出

## 実装ステップ

### 1. Code Scanning用の脆弱なPythonコード作成

**作成ファイル**: `vulnerable_app.py`

以下の脆弱性パターンを含むコード:
- **SQL Injection**: ユーザー入力を直接SQLクエリに埋め込む
- **Command Injection**: os.system()にユーザー入力を直接渡す
- **Path Traversal**: ファイルパスの検証なしでユーザー入力を使用
- **Hardcoded Credentials**: コード内にパスワードをハードコード
- **Insecure Deserialization**: pickle.loads()の安全でない使用

**作成ファイル**: `web_app.py`

FlaskベースのWebアプリケーションで:
- **XSS (Cross-Site Scripting)**: エスケープなしでユーザー入力を表示
- **CSRF**: CSRF保護なしのフォーム
- **Insecure Direct Object Reference**: 権限チェックなしのリソースアクセス

### 2. Secret Scanning用のダミーシークレット

**作成ファイル**: `.env.example`
- ダミーのAWS Access Key形式の文字列
- ダミーのGitHub Personal Access Token形式の文字列
- ダミーのAPI Key

**作成ファイル**: `config.py`
- コード内にハードコードされたダミーAPIキー
- ダミーのデータベース接続文字列

**注意**: すべてダミーデータで、実際には使用できないが形式は本物に似せる

### 3. Dependency Review用の古い依存関係

**作成ファイル**: `requirements.txt`

既知の脆弱性がある古いバージョンを指定:
- `Flask==0.12.2` (複数の既知の脆弱性あり)
- `requests==2.6.0` (古いバージョン)
- `Pillow==6.0.0` (CVEあり)
- `PyYAML==3.12` (任意コード実行の脆弱性)

### 4. GitHub Actions ワークフロー設定

**作成ファイル**: `.github/workflows/codeql-analysis.yml`

CodeQLによる自動スキャンを設定:
- Python言語の指定
- プッシュとプルリクエストでトリガー
- 週次スケジュールスキャン

### 5. Dependabot設定

**作成ファイル**: `.github/dependabot.yml`

依存関係の自動更新とセキュリティアラート:
- pip (Python)パッケージの監視
- 毎日チェック

### 6. .gitignore設定

**作成ファイル**: `.gitignore`

Python関連の標準的な除外設定:
- `__pycache__/`
- `*.pyc`
- `.env` (実際の.envファイルは除外、.env.exampleのみコミット)
- `venv/`

### 7. README更新

**更新ファイル**: `README.md`

以下を追加:
- このリポジトリの目的（GHAS検証用）
- 含まれる脆弱性の種類の説明
- **警告**: 本番環境では絶対に使用しないこと
- 各GHAS機能の確認方法

## 検証手順

### Code Scanningの確認
1. コードをpushした後、GitHubリポジトリの「Security」タブを確認
2. 「Code scanning alerts」セクションで検出された脆弱性を確認
3. 各アラートの詳細、推奨される修正方法を確認

### Secret Scanningの確認
1. 「Security」タブの「Secret scanning alerts」を確認
2. 検出されたシークレットの種類と場所を確認
3. アラートの無効化・解決方法を確認

### Dependency Reviewの確認
1. 「Security」タブの「Dependabot alerts」を確認
2. 検出された脆弱な依存関係のリストを確認
3. Dependabotが提案する自動PR（もしあれば）を確認

### GitHub Actions ワークフロー確認
1. 「Actions」タブでCodeQL analysisワークフローの実行状況を確認
2. ワークフローログで検出プロセスを確認

## 重要な注意事項

1. **本番環境での使用禁止**: このコードは検証・学習目的のみ
2. **ダミーデータのみ**: すべてのシークレットはダミー（無効なもの）
3. **公開リポジトリ**: パブリックリポジトリとして公開するため、実際のシークレットは含めない
4. **アラートの扱い**: 検出されたアラートは意図的なものなので、学習目的で残す

## 期待される結果

- **Code Scanning**: 10個以上のセキュリティアラート検出
- **Secret Scanning**: 3-5個のシークレット検出
- **Dependency Review**: 4個の脆弱な依存関係検出

## 重要なファイル一覧

- `vulnerable_app.py`: 脆弱性のあるPythonコード（CLI/バックエンド）
- `web_app.py`: 脆弱性のあるFlaskアプリ（Web）
- `.env.example`: ダミーシークレットのサンプル
- `config.py`: ハードコードされたシークレット
- `requirements.txt`: 脆弱な依存関係
- `.github/workflows/codeql-analysis.yml`: CodeQL設定
- `.github/dependabot.yml`: Dependabot設定
- `.gitignore`: Python標準の除外設定
- `README.md`: プロジェクト説明と警告
